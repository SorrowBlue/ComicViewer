name: List
on:
  workflow_call:

jobs:

  detekt:
    runs-on: macos-latest
    strategy:
      matrix:
        target: [ Android, Desktop, Ios, Metadata ]
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup JDK and Gradle
        uses: ./.github/actions/setup-java-gradle
      - name: üîçÔ∏èRun detekt
        run: ./gradlew detekt${{ matrix.target }}All
      - name: Upload Detekt SARIF
        uses: github/codeql-action/upload-sarif@v3
        if: ${{ !cancelled() }}
        with:
          sarif_file: build/reports/detekt/merge.sarif
          category: detekt

  checkVersionCatalog:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup JDK and Gradle
        uses: ./.github/actions/setup-java-gradle
      - name: Run check VersionCatalog
        run: ./gradlew checkVersionCatalog

  lint:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        variant: [ Debug, Internal, Prerelease, Release ]
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup JDK and Gradle
        uses: ./.github/actions/setup-java-gradle
      - name: üö®Run lint
        run: ./gradlew composeApp:lint${{ matrix.variant }}
      - name: Upload Lint SARIF
        uses: github/codeql-action/upload-sarif@v3
        if: ${{ !cancelled() }}
        with:
          sarif_file: build/reports/lint/lint-result.sarif
          category: android-lint

  lint-aggregate:
    name: All Lint Checks Passed
    runs-on: ubuntu-latest
    needs: [ detekt, checkVersionCatalog, lint ]
    steps:
      - name: Confirm All Lint Jobs Succeeded
        run: echo "‚úÖ All lint jobs succeeded!"
